# 执行上下文
[深入理解javascript原型和闭包（11）——执行上下文栈 - 王福朋 - 博客园](http://www.cnblogs.com/wangfupeng1988/p/3989357.html)

* 执行上下文的定义：在执行代码之前，把将要用到的所有的变量都事先拿出来，有的直接赋值了，有的先用undefined占个空

## 浏览器的准备工作
	* 变量、函数表达式——变量声明or变量声明提前，默认赋值为undefined
	* this——赋值
	* 函数声明——赋值
```
//example1
console.log(a); //undefined
var a = 10; 

console.log(f1); //function f1() { }
function f1() { } //函数

console.log(f1); //undefined
var f2 = function() { } //函数表达式

//example2
function foo() {
	console.log('foo1');
}

foo(); // foo2

function foo(){
	console.log('foo2');
}

foo(); // foo2
```

## 函数每被调用一次，都会产生一个新的执行上下文环境
```
function fn(x) {
	console.log(arguments); // [10]
	console.log(x); // 10
}
fn(10);
```

## 函数在定义的时候（不是调用的时候），就已经确定了函数体内部自由变量的作用域
```
var a = 10;
function fn() {
	console.log(a); // a是作用域
} //函数创建时，就确定了a要取值的作用域

function bar(f) {
	var a = 20;
	f(); // 10
}
bar(fn);
```

## 其实这是一个压栈出栈道过程——执行上下文
* 执行全局代码时，会产生一个执行上下文环境，每次调用函数都又会产生执行上下文环境。当函数调用完成时，这个上下文环境以及其中的数据都会被消除，再重新回到全局上下文环境。处于活动状态的执行上下文环境只有一个。

[image:8621096F-AD78-45B8-ACD3-D4BD8B05C87C-62810-0001D06E2BBAEA4D/1DF4348B-BBC4-464C-A143-9697C0CFFFD4.png]


## 自由变量
* 自由变量是指在函数中使用，但既不是函数参数也不是函数的局部变量的变量
```
var x = 10;
function fn(){
	console.log(x);
}
function show(f){
	var x = 20;
	(function(){
		fn();
	})();
}
show(fn); // 10
```
* 要到创建这个函数的作用域中取值——是**创建**，而不是**调用**，这就是所谓的静态作用域
